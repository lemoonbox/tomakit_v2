{% extends 'base.html'%}
{% load static from staticfiles %}
{% load humanize %}
{% load v2d1_board_tags %}
<title>{%block title%}Tomakit {{post.title}}{%endblock%}</title>
{%block style%}
<style>
    body {background-color:#fff!important;}
    .html5-video-content {width:100%!important;}
    /*.col-lg-12 img {max-width:100px;}*/
    .item >img {width:100%;}
    .item {max-height:500px;overflow:hidden;}    /*.tmk-class-pay img {max-width:100px;}*/
    .tmk-class-pay {border:1px solid #ddd;border-radius:4px;}
    .tmk-class-pay-top {padding:10px;}
    .tmk-class-pay .tmk-h3 {border-bottom:1px solid #ddd;padding:15px;margin-top:0px;}
    .tmk-class-pay label {line-height:36px;color:#82888A;font-size:14px;font-weight:normal;width:35%;vertical-align:middle;}
    .col-lg-12 img {max-width:100px;}
    .tmk-infobox-price {height:120px; line-height:24px;text-align:left;background-color:#eee;padding:10px;}
    .tmk-infobox-price div {float:left;width:50%;}
    .tmk-infobox-price label {line-height:18px;}
    .tmk-infobox-profile{float:left;width:100%;text-align:left;padding:10px;}
    .tmk-infobox-profile .img-grid {width:30%;float:left;overflow:hidden;vertical-align:middle;z-index:1}
    .img-grid img{z-index:0;}
    .tmk-infobox-profile .infobox-img-wrapper {border-radius:50%;width:55px;height:55px;overflow:hidden;}
    .tmk-infobox-profile .infobox-img-wrapper img {width:150%;position:center;}
    /*.tmk-infobox-price*/
    .tmk-infobox-profile div {width:60%;float:left;}
    .tmk-infobox-profile label {width:60%;line-height:20px;}
    .tmk-infobox-profile .h3 {margin:0px;padding:0;}
    .tmk-main-body {font-size:18px;line-height:28px;}
    .col-lg-8 .tmk-h2 {text-align:left;}
    .tmk-post-detail .tmk-h3 {text-align:left;}

    .tmk-review {margin: 50px auto!important;}
    /*.tmk-review .col-md-8 {padding:0px;}*/
    .tmk-review .btn-primary {width:170px;height:80px;}
    .tmk-review textarea {height:80px;}
    .img-wrap img {width:100%;}
    .col-md-2 img {width:100px;}
    .review-wrapper {margin:20px auto;}
    .review-wrapper .btn-link {display:inline!important;float:left!important;}

</style>

{%endblock%}

<body>
{%block content%}

<br>
<!--워크샵 수업 상세 페이지-->

<div class="tmk-main-body col-lg-12">
    <div class="container">
        <div class="tmk-page-header col-lg-12">
            <div class="tmk-h4">{{post.category.category|cate2han}}</div>
            <div class="tmk-h2 tmk-title">{{post.title}}</div>
            <div class="tmk-h4">{{post.intro_line}}</div>
            <span class="label tmk-label">D-{{post.deadline|d_day_count}}</span>
        </div>
        <!--<div class="tmk-page-pick col-lg-12"></div>-->
        <div class="col-lg-12">
            <div id="class-post-carousel" class="carousel slide" data-ride="carousel">
                <!--Indicators -->
                <ol class="carousel-indicators">
                    {% for image in post.t2classpic_set.all%}{% if forloop.counter0 == 0 %}
                    <li data-target="#class-post-Carousel" data-slide-to="{{forloop.counter0}}" class="active"></li>
                    {% else %}
                    <li data-target="#class-post-Carousel" data-slide-to="{{forloop.counter0}}"></li>
                    {% endif %} {%endfor%}
                </ol>
                <!-- Wrapper for slides -->
                <div class="carousel-inner" role="listbox">
                    {% for image in post.t2classpic_set.all%} {% if forloop.counter0 == 0 %}
                    <div class="item active">
                        <img src="{{MEDIA_URL}}{{image.image}}" alt="{{post.title}} image{{forloop.counter0}}">
                    </div>
                    {% else %}
                    <div class="item">
                        <img src="{{MEDIA_URL}}{{image.image}}" alt="{{post.title}} image{{forloop.counter0}}">
                    </div>
                    {% endif %}{%endfor%}
                </div>
                <!-- Left and right controls -->
                <a class="left carousel-control" href="#class-post-Carousel" role="button" data-slide="prev">
                    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="right carousel-control" href="#class-post-Carousel" role="button" data-slide="next">
                    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
        </div>

        <div class="tmk-post-body">
            <div class="col-lg-8 tmk-post-detail">
                <div class="tmk-h2" style="font-weight:bold;">클래스 소개</div>
                <!--동영상-->
                {% if post.video%}
                <iframe width="100%" height="480px" src="https://www.youtube.com/embed/{{post.video}}" frameborder="0" allowfullscreen></iframe>
                {% endif %}
                <div class="tmk-h3">소개</div>
                <div class="tmk-panel">{{post.descript}}</div>

                <div class="tmk-h3">커리큘럼</div>
                <div class="tmk-panel">{{post.curri}}</div>
                <div class="tmk-h3">안내사항</div>
                <div class="tmk-panel">{{post.notic}}</div>

                <div class="tmk-h3">공방위치</div>
                <div class="tmk-panel">{{post.addr}}</div>

                <div class="tmk-h3">선생님 소개</div>
                <div class="tmk-panel">
                    <a href="http://{{HTTP_HOST}}/v2.1/user/profile/{{post.user.id}}">
                        <img src="{{MEDIA_URL}}{{post.user.t2profile_set.first.pro_pic}}">
                        {{post.user.last_name}}{{post.user.first_name}}</a>
                    {{post.user.t2hostprofile_set.first.intro_self}}
                </div>
            </div>

        </div>

        <div class="col-lg-4">
            <div class="tmk-class-pay">
                <div class="tmk-class-pay-top">
                    <!--<div class=h3>수업정보</>-->
                    <div class="tmk-h3" style="font-weight:bold;">{{post.repeat}}회 과정 / 총 {% widthratio post.repeat 1 post.perhour%}시간</div>
                    <div style="text-align:left;">
                        <div>
                            <label><img src="{%static 'media/image/slice/icon-intro_time.png'%}"> 모집 마감일</label> {{post.deadline|date:"Y년 n월 d"}}
                        </div>
                        <div>
                            <label><img src="{%static 'media/image/slice/icon-intro_flag.png'%}"> 수업 시작일 </label> {{post.deadline|date:"Y년 n월 d"}}
                        </div>
                        <div>
                            <label><img src="{%static 'media/image/slice/icon-intro_clock.png'%}"> 수업 일정</label> {{post.weekday}}
                        </div>
                        <div>
                            <label><img src="{%static 'media/image/slice/icon-intro_people.png'%}"> 인원</label> 소수 맞춤수업
                            최소 {{post.min_num}}명 ~ 최대 {{post.max_num}}명
                        </div>
                        <div>
                            <label><img src="{%static 'media/image/slice/icon-intro_location.png'%}"> 장소</label> {{post.addr}}
                        </div>
                    </div>
                </div>
                <div class="tmk-infobox-price">
                    <div><label>재료비</label><br>
                        {{post.extra_price|intcomma}}<br>
                        <label>수강료</label><br>
                        {{post.price|intcomma}}</div>
                    <div>합계 {{ post.extra_price|add:post.price |intcomma}}</div>
                </div>
                <!--강사 프로필-->
                <div class="tmk-infobox-profile">
                    <a href="http://{{HTTP_HOST}}/v2.1/user/profile/{{post.user.id}}">
                        <div class="img-grid">
                            <div class="infobox-img-wrapper">
                                <img src="{{MEDIA_URL}}{{post.user.t2profile_set.first.pro_pic}}">
                            </div>
                        </div>
                        <div>
                            <label>클래스 선생님</label><br>
                            <div class="h3">{{post.user.last_name}}{{post.user.first_name}}</div>
                        </div>
                    </a>
                </div>

                <div style="padding:10px;">
                    <!-- 결제 하기 -->
                    <form method="GET" action="{% url 'pay_prefill_v2d1' %}">
                        <input type="hidden" value="{{post.id}}" name="post_id">
                        <input type="hidden" value="teachclass" name="classtype">
                        <button class="btn btn-primary btn-block">
                            신청하기 <input type="submit" value="{{ post.extra_price|add:post.price |intcomma}}원" hidden>
                        </button>
                    </form>
                </div>

            </div>
        </div>
    </div>
</div>
<div class="tmk-main-body col-lg-12">
    <div class="container">
    <div class="tmk-review col-md-8">
<div class="tmk-h3 pull-left"><span style="color:#84CDC2;">"리뷰 숫자"</span>개의 후기가 있습니다</div>
            <div class="review-wrapper col-md-12">
                <form method="POST" action="{% url 'create_review_v2d1' post.id %}">
                    {%csrf_token%}
                    <div class="col-md-2">
                        <div class="tmk-card-img-profile" style="margin-top:15px;">
                            <div class="card-link">
                                <img src="{{MEDIA_URL}}{{user.t2profile_set.first.pro_pic}}">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-7" style="text-align:left;">
                        <input type="hidden" name="class_num" value="{{post.id}}">
                        <input type="hidden" name="classtype" value="teach_class">
                        <textarea class="form-control" name="review"></textarea>
                        <!--<img src="{%static 'media/image/slice/icon-star_empty.png'%}">-->
                        <input class="form-control" type="number" name="grade" min="1" max="5"><br>
                        {{review.review.errors|striptags}} {{review.grade.errors|striptags}}
                    </div>
                    <div class="col-md-3">
                        <input class="btn btn-primary" type="submit" value="후기 작성">
                    </div>
                </form>
            </div>
            <div class="review-wrapper col-md-12">
                {% for review in post.t2classreview_set.all%}
                {% if review.is_active %}
                <div class="col-md-2" style="margin-top:15px;">

                    <div class="tmk-card-img-profile">
                        <div class="card-link">
                            <a href="http://{{HTTP_HOST}}/v2.1/user/profile/{{review.user.id}}">
                                <img src="{{MEDIA_URL}}{{review.user.t2profile_set.first.pro_pic}}">
                        </a>
                        </div>
                    </div>
                        
                </div>
                <div class="col-md-7" id="user-review">
                    <a href="http://{{HTTP_HOST}}/v2.1/user/profile/{{review.user.id}}">
                        {{review.user.last_name}}{{review.user.first_name}}
                    </a> {{review.grade}}
                    <!--댓글-->
                    <div>{{review.review}}</div>
                </div>

                <!--수정 form 나중에  hidden-->
                <div id="review-modify" hidden>
                    <form method="POST" action="{% url 'modify_review_v2d1' post.id %}">
                        {%csrf_token%}
                        <div class="col-md-7">
                            <input type="hidden" name="review_num" value="{{review.id}}">
                            <input type="hidden" name="class_num" value="{{post.id}}">
                            <input type="hidden" name="classtype" value="teach_class">
                            <textarea class="form-control" name="review">{{review.review}}</textarea>
                            <input class="form-control" type="number" name="grade" value="{{review.grade}}" min="1" max="5"><br>
                            {{review.review.errors|striptags}}
                            {{review.grade.errors|striptags}}
                        </div>
                        <div class="col-md-1">
                            <input class="btn btn-link" id="modify-end" type="submit" value="수정 완료">
                        </div>
                    </form>
                </div>
                    <!--사용자가 단 댓글인 경우에만 visible되는-->
                    <div class="col-md-1" id="modify-wrap">
                        <span class="btn btn-link" id="modify-btn">댓글 수정</span>
                    </div>
                    <form method="POST" action="{% url 'delete_review_v2d1' review.id%}">
                        {%csrf_token%}
                        <input type="hidden" name="classtype" value="teach_class">
                        <div class="col-md-1">
                            <input class="btn btn-link" type="submit" value="리뷰 삭제">
                        </div>
                    </form>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>

<div class="tmk-main-body col-lg-12" style="background:#eee;margin-top:3px;margin-bottom:-50px;padding:30px;">
    <div style="margin:50px auto;">
        <div class="tmk-h3" style="font-weight:bold;">원하는 클래스를 찾지 못했나요?</div>
        <div class="tmk-h4">클래스를 제안해보세요 원하시는 클래스를 개설해드린답니다</div>
        <a href="http://{{HTTP_HOST}}/v2.1/demand/create" class="btn btn-link" style="color:red;">클래스 제안하기 ></a>

    </div>
</div>
{%endblock%}
{%block script%}
<script>
    $(document).ready(function(){
        $("#modify-btn").click(function(){
            $("#modify-wrap").hide();
            $("#user-review").hide();
            $("#review-modify").show();
        });
    });
</script>
{%endblock%}
