{% extends 'base.html'%}
{% load static from staticfiles %}
{% load humanize %}
{% load v2d1_board_tags %}
<title>{%block title%}Tomakit {{post.title}}{%endblock%}</title>
{%block style%}
<style>
    body {background-color:#fff!important;}
    .html5-video-content {width:100%!important;}
    /*.col-lg-12 img {max-width:100px;}*/
    .item >img {width:100%;}
    .item {max-height:500px;overflow:hidden;}    /*.tmk-class-pay img {max-width:100px;}*/
    .tmk-class-pay {border:1px solid #ddd;border-radius:4px;}
    .tmk-class-pay-top {padding:10px;}
    .tmk-class-pay .tmk-h3 {border-bottom:1px solid #ddd;padding:15px;margin-top:0px;}
    .tmk-class-pay label {line-height:36px;color:#82888A;font-size:14px;font-weight:normal;width:35%;vertical-align:middle;}
    .col-lg-12 img {max-width:100px;}
    .tmk-infobox-price {height:120px; line-height:24px;text-align:left;background-color:#eee;padding:10px;}
    .tmk-infobox-price div {float:left;min-width:46%;}
    .tmk-infobox-price label {line-height:18px;}
    .tmk-infobox-profile{float:left;width:100%;text-align:left;padding:10px;}
    .tmk-infobox-profile .img-grid {width:80px;float:left;overflow:hidden;vertical-align:middle;}

    .card-link {z-index:1!important;}
    .card-link img {z-index:0!important;}

    .tmk-infobox-profile .infobox-img-wrapper {border-radius:50%;width:55px;height:55px;overflow:hidden;}
    .tmk-infobox-profile .infobox-img-wrapper img {width:150%;position:center;}
    /*.tmk-infobox-price*/
    .tmk-infobox-profile div {width:60%;float:left;}
    .tmk-infobox-profile label {width:60%;line-height:20px;}
    .tmk-infobox-profile .h3 {margin:0px;padding:0;}
    .tmk-main-body {font-size:18px;line-height:28px;}
    .col-lg-8 .tmk-h2 {text-align:left;}
    .tmk-post-detail .tmk-h3 {text-align:left;}

    .tmk-review {margin: 50px auto!important;}
    /*.tmk-review .col-md-8 {padding:0px;}*/
    .tmk-review .btn-primary {width:170px;height:80px;}
    .tmk-review textarea {height:80px;}
    .img-wrap img {width:100%;}
    .col-md-2 img {width:100px;}
    .review-wrapper {margin:20px auto;}
    .review-wrapper .btn-link {display:inline!important;float:left!important;}
    #user-review {text-align:left;}

    .modify-btn {min-height:150px;}
    .review-del {min-height:150px;}
    @media screen and (min-width:1200px) {
        #sidebar {
            margin-bottom: -800px;
        }
        /*#submit-review {position:absolute;top:-90px;left:0;}*/
    }
    @media screen and (min-width:992px) {
        #submit-review {position:absolute;top:-90px;left:0;}
    }
    @media screen and (max-width:991px) {
        #submit-review {height:42px;}
    }
    .tmk-panel {border-bottom:none;}




    .modify-btn {min-height:150px;}
    .review-del {min-height:150px;}
</style>

{%endblock%}

<body>
{%block content%}

<br>
<!--워크샵 수업 상세 페이지-->

<div class="tmk-main-body col-lg-12">
    <div class="container">
        <div class="tmk-page-header col-lg-12">
            <div class="tmk-h4">{{post.category.category|cate2han}}</div>
            <div class="tmk-h2 tmk-title">{{post.title}}</div>
            <div class="tmk-h4">{{post.intro_line}}</div>
            <span class="label tmk-label">D-{{post.deadline|d_day_count}}</span>
        </div>
        <!--<div class="tmk-page-pick col-lg-12"></div>-->
        <div class="col-lg-12">
            <div id="class-post-carousel" class="carousel slide" data-ride="carousel">
                <!--Indicators -->
                <ol class="carousel-indicators">
                    {% for image in post.t2classpic_set.all%}{% if forloop.counter0 == 0 %}
                    <li data-target="#class-post-Carousel" data-slide-to="{{forloop.counter0}}" class="active"></li>
                    {% else %}
                    <li data-target="#class-post-Carousel" data-slide-to="{{forloop.counter0}}"></li>
                    {% endif %} {%endfor%}
                </ol>
                <!-- Wrapper for slides -->
                <div class="carousel-inner" role="listbox">
                    {% for image in post.t2classpic_set.all%} {% if forloop.counter0 == 0 %}
                    <div class="item active">
                        <img src="{{MEDIA_URL}}{{image.image}}" alt="{{post.title}} image{{forloop.counter0}}">
                    </div>
                    {% else %}
                    <div class="item">
                        <img src="{{MEDIA_URL}}{{image.image}}" alt="{{post.title}} image{{forloop.counter0}}">
                    </div>
                    {% endif %}{%endfor%}
                </div>
                <!-- Left and right controls -->
                <a class="left carousel-control" href="#class-post-Carousel" role="button" data-slide="prev">
                    <span style="line-height:500px;font-size:38px;"><</span>
                    <!--<span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>-->
                    <span class="sr-only">Previous</span>
                </a>
                <a class="right carousel-control" href="#class-post-Carousel" role="button" data-slide="next">
                    <span style="line-height:500px;font-size:38px;">></span>
                    <!--<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>-->
                    <span class="sr-only">Next</span>
                </a>
            </div>
        </div>

        <div class="tmk-post-body">
            <div class="col-lg-4 hidden-lg" style="margin-bottom:50px;">
                <div class="tmk-class-pay">
                    <div class="tmk-class-pay-top">
                        <!--<div class=h3>수업정보</>-->
                        <div class="tmk-h3" style="font-weight:bold;">{{post.repeat}}회 과정 / 총 {% widthratio post.repeat 1 post.perhour%}시간</div>
                        <div style="text-align:left;">
                            <div>
                                <label><img src="{%static 'media/image/slice/icon-intro_time.png'%}"> 모집 마감일</label> {{post.deadline|date:"Y년 n월 d일"}}
                            </div>
                            <div>
                                <label><img src="{%static 'media/image/slice/icon-intro_flag.png'%}"> 수업 시작일 </label> {{post.deadline|date:"Y년 n월 d일"}}
                            </div>
                            <div>
                                <label><img src="{%static 'media/image/slice/icon-intro_clock.png'%}"> 수업 일정</label> {{post.weekday}}
                            </div>
                            <div>
                                <label><img src="{%static 'media/image/slice/icon-intro_people.png'%}"> 인원</label>
                                최소 {{post.min_num}}명 ~ 최대 {{post.max_num}}명
                            </div>
                            <div>
                                <label><img src="{%static 'media/image/slice/icon-intro_location.png'%}"> 장소</label> {{post.addr}}
                            </div>
                        </div>
                    </div>
                    <div class="tmk-infobox-price">
                        <div><label>재료비</label><br>
                            <span class="small">￦</span> {{post.extra_price|intcomma}}<br>
                            <label>수강료</label><br>
                            <span class="small">￦</span> {{post.price|intcomma}}</div>
                        <div class="pull-right" style="text-align:right;padding-top: 72px;">합계<span class="tmk-h3" style="border-bottom:none;">￦{{ post.extra_price|add:post.price |intcomma}}</span></div>
                    </div>
                    <!--강사 프로필-->
                    <div class="tmk-infobox-profile">
                        <a href="http://{{HTTP_HOST}}/v2.1/user/profile/{{post.user.id}}">
                            <div class="img-grid">
                                <div class="infobox-img-wrapper">
                                    <img src="{{MEDIA_URL}}{{post.user.t2profile_set.first.pro_pic}}">
                                </div>
                            </div>
                            <div>
                                <label>클래스 선생님</label><br>
                                <div class="h3" style="color:#565A5C;">{{post.user.last_name}}{{post.user.first_name}}</div>
                            </div>
                        </a>
                    </div>

                    <div style="padding:10px;">
                        <!-- 결제 하기 -->
                        <form method="GET" action="{% url 'pay_prefill_v2d1' %}">
                            <input type="hidden" value="{{post.id}}" name="post_id">
                            <input type="hidden" value="teachclass" name="classtype">
                            <button class="btn btn-primary btn-block">
                                신청하기 <input type="submit" value="{{ post.extra_price|add:post.price |intcomma}}원" hidden>
                            </button>
                        </form>
                    </div>

                </div>
            </div>
            <div class="col-lg-8 tmk-post-detail">
                <div class="tmk-h2" style="font-weight:bold;">클래스 소개</div>
                <!--동영상-->
                {% if post.video%}
                <iframe width="100%" height="480px" src="https://www.youtube.com/embed/{{post.video}}" frameborder="0" allowfullscreen></iframe>
                {% endif %}
                <div class="tmk-h3">소개</div>
                <div class="tmk-panel">{{post.descript}}</div>

                <div class="tmk-h3">커리큘럼</div>
                <div class="tmk-panel">{{post.curri}}</div>
                <div class="tmk-h3">안내사항</div>
                <div class="tmk-panel">{{post.notic}}</div>

                <div class="tmk-h3">공방위치</div>
                <div class="tmk-panel">{{post.addr}}</div>

                <div class="tmk-h3">선생님 소개</div>
                <div class="tmk-panel well" style="border:none;padding-top:50px;">
                    <div class="col-lg-2" style="float:left;">
                        <a href="http://{{HTTP_HOST}}/v2.1/user/profile/{{post.user.id}}">
                            <div class="tmk-infobox-profile">
                                <div class="img-grid">
                                    <div class="infobox-img-wrapper">
                                        <img src="{{MEDIA_URL}}{{post.user.t2profile_set.first.pro_pic}}">
                                    </div>
                                </div></div>
                        </a>
                    </div>
                    <div class="col-lg-10">
                        <span  style="line-height:16px;">클래스 선생님</span><br>
                        <a href="http://{{HTTP_HOST}}/v2.1/user/profile/{{post.user.id}}">
                            <div class="tmk-h3"  style="line-height:16px;">{{post.user.last_name}}{{post.user.first_name}}</div>
                        </a>
                    </div>
                    <div class="col-lg-12"><br>{{post.user.t2hostprofile_set.first.intro_self}}</div>
                    <div class="col-lg-12">
                        <a class="btn-link pull-right" href="http://{{HTTP_HOST}}/v2.1/user/profile/{{post.user.id}}" style="font-size:14px;color:red;">프로필 보기 ></a>
                    </div>
                </div>
            </div>

        </div>

        <div class="col-lg-4 visible-lg" id="sidebar">
            <div class="tmk-class-pay">
                <div class="tmk-class-pay-top">
                    <!--<div class=h3>수업정보</>-->
                    <div class="tmk-h3" style="font-weight:bold;">{{post.repeat}}회 과정 / 총 {% widthratio post.repeat 1 post.perhour%}시간</div>
                    <div style="text-align:left;">
                        <div>
                            <label><img src="{%static 'media/image/slice/icon-intro_time.png'%}"> 모집 마감일</label> {{post.deadline|date:"Y년 n월 d일"}}
                        </div>
                        <div>
                            <label><img src="{%static 'media/image/slice/icon-intro_flag.png'%}"> 수업 시작일 </label> {{post.deadline|date:"Y년 n월 d일"}}
                        </div>
                        <div>
                            <label><img src="{%static 'media/image/slice/icon-intro_clock.png'%}"> 수업 일정</label> {{post.weekday}}
                        </div>
                        <div>
                            <label><img src="{%static 'media/image/slice/icon-intro_people.png'%}"> 인원</label>
                            최소 {{post.min_num}}명 ~ 최대 {{post.max_num}}명
                        </div>
                        <div>
                            <label><img src="{%static 'media/image/slice/icon-intro_location.png'%}"> 장소</label> {{post.addr}}
                        </div>
                    </div>
                </div>
                <div class="tmk-infobox-price">
                    <div><label>재료비</label><br>
                        <span class="small">￦</span> {{post.extra_price|intcomma}}<br>
                        <label>수강료</label><br>
                        <span class="small">￦</span> {{post.price|intcomma}}</div>
                    <div class="pull-right" style="text-align:right;padding-top: 72px;">합계<span class="tmk-h3" style="border-bottom:none;">￦{{ post.extra_price|add:post.price |intcomma}}</span></div>
                </div>
                <!--강사 프로필-->
                <div class="tmk-infobox-profile">
                    <a href="http://{{HTTP_HOST}}/v2.1/user/profile/{{post.user.id}}">
                        <div class="img-grid">
                            <div class="infobox-img-wrapper">
                                <img src="{{MEDIA_URL}}{{post.user.t2profile_set.first.pro_pic}}">
                            </div>
                        </div>
                        <div>
                            <label>클래스 선생님</label><br>
                            <div class="h3" style="color:#565A5C;">{{post.user.last_name}}{{post.user.first_name}}</div>
                        </div>
                    </a>
                </div>

                <div style="padding:10px;">
                    <!-- 결제 하기 -->
                    <form method="GET" action="{% url 'pay_prefill_v2d1' %}">
                        <input type="hidden" value="{{post.id}}" name="post_id">
                        <input type="hidden" value="teachclass" name="classtype">
                        <button class="btn btn-primary btn-block">
                            신청하기 <input type="submit" value="{{ post.extra_price|add:post.price |intcomma}}원" hidden>
                        </button>
                    </form>
                </div>

            </div>
        </div>
    </div>
</div>
<div class="tmk-main-body col-lg-12" style="border-bottom:2px solid #ddd;background:#fff;">
    <div class="container">
        <div class="tmk-review col-lg-8">
            <div class="tmk-h3 col-xs-12" style="text-align:left;"><span style="color:#84CDC2;">"리뷰 숫자"</span>개의 후기가 있습니다</div>
            <div class="review-wrapper col-md-12">
                <form method="POST" action="{% url 'create_review_v2d1' post.id %}">
                    {%csrf_token%}
                    <div class="col-xs-2">
                        <div class="tmk-card-img-profile" style="margin-top:15px;">
                            <div class="card-link">
                                <img src="{{MEDIA_URL}}{{user.t2profile_set.first.pro_pic}}">
                            </div>
                        </div>
                    </div>
                    <!--<div class="col-md-7"></div>-->
                    <div class="col-xs-10 col-md-7" style="text-align:left;">
                        <input type="hidden" name="class_num" value="{{post.id}}">
                        <input type="hidden" name="classtype" value="teach_class">
                        <textarea class="form-control" name="review"></textarea>
                    </div>
                    <div class="col-xs-5 col-md-7 col-xs-offset-2" style="text-align:left;">
                        <!--<img src="{%static 'media/image/slice/icon-star_empty.png'%}">-->
                        <input class="form-control" type="number" name="grade" min="1" max="5"><br>
                        <div class="tmk-error">{{review.review.errors|striptags}} {{review.grade.errors|striptags}}</div>
                    </div>
                    <div class="col-md-3 col-xs-5">
                        <input class="btn btn-primary pull-right" id="submit-review" type="submit" value="후기 작성">
                    </div>
                </form>
            </div>
            <div class="review-wrapper col-xs-12 col-md-12">
                {% for review in post.t2classreview_set.all%}
                {% if review.is_active %}
                <div class="col-xs-2">

                    <div class="tmk-card-img-profile">
                        <div class="card-link">
                            <a href="http://{{HTTP_HOST}}/v2.1/user/profile/{{review.user.id}}">
                                <img src="{{MEDIA_URL}}{{review.user.t2profile_set.first.pro_pic}}">
                            </a>
                        </div>
                    </div>

                </div>
                <div class="col-md-7 col-xs-10 user-review">
                    <a href="http://{{HTTP_HOST}}/v2.1/user/profile/{{review.user.id}}">
                        {{review.user.last_name}}{{review.user.first_name}}
                    </a> {{review.grade}}
                    <!--댓글-->
                    <div>{{review.review}}</div>
                </div>

                <!--수정 form 나중에  hidden-->
                <div class="review-modify" hidden>
                    <form method="POST" action="{% url 'modify_review_v2d1' post.id %}">
                        {%csrf_token%}
                        <div class="col-md-7">
                            <input type="hidden" name="review_num" value="{{review.id}}">
                            <input type="hidden" name="class_num" value="{{post.id}}">
                            <input type="hidden" name="classtype" value="teach_class">
                            <textarea class="form-control" name="review">{{review.review}}</textarea>
                            <input class="form-control" type="number" name="grade" value="{{review.grade}}" min="1" max="5"><br>
                            {{review.review.errors|striptags}}
                            {{review.grade.errors|striptags}}
                        </div>
                        <div class="col-md-2 col-xs-2 pull-right" style="margin-right:15px;">
                            <input class="btn btn-link modify-end" type="submit" value="수정 완료">
                        </div>
                    </form>
                </div>
                <!--사용자가 단 댓글인 경우에만 visible되는-->
                <div class="col-md-2 col-xs-2 pull-right modify-wrap" style="margin-right:15px;">
                    <span class="btn btn-link modify-btn">댓글 수정</span>
                </div>
                <div class="col-md-2 col-xs-2 pull-right review-del" style="padding-left:0;" hidden>
                <form method="POST" action="{% url 'delete_review_v2d1' review.id%}">
                    {%csrf_token%}
                    <input type="hidden" name="classtype" value="teach_class">
                    <input class="btn btn-link" type="submit" value="리뷰 삭제">
                </form>
                    </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>
</div>

<div class="tmk-main-body col-lg-12" style="background:#eee;margin-bottom:-50px;padding:30px;">
    <div style="margin:50px auto;">
        <div class="tmk-h3" style="font-weight:bold;">원하는 클래스를 찾지 못했나요?</div>
        <div class="tmk-h4">클래스를 제안해보세요 원하시는 클래스를 개설해드린답니다</div>
        <a href="http://{{HTTP_HOST}}/v2.1/demand/create" class="btn btn-link" style="color:red;">클래스 제안하기 ></a>

    </div>
</div>
{%endblock%}
{%block script%}
<script>
    $(document).ready(function(){
        $(".modify-btn").click(function(){
            $(".modify-wrap").hide();
            $(".user-review").hide();
            $(".review-modify").show();
            $(".review-del").show();
        });
    });
</script>
<script>

    $(function() {
        var $sidebar   = $("#sidebar"),
                $window    = $(window),
                offset     = $sidebar.offset(),
                topPadding = 15;
        $window.scroll(function() {
            if ($window.scrollTop() > offset.top) {
                $sidebar.stop().animate({
                    marginTop: $window.scrollTop() - offset.top + topPadding
                });
            } else {
                $sidebar.stop().animate({
                    marginTop: 0
                });
            }
        });
    });

</script>
{%endblock%}
